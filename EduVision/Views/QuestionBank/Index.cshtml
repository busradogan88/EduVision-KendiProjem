@model List<EduVision.Controllers.QuestionBankViewModel>

@{
    ViewData["Title"] = "Soru Bankası";
}

<nav class="main-nav">
    <div class="nav-left">
        <span class="logo-text">EduVision</span>
    </div>
    <div class="nav-links">
        <a asp-controller="Home" asp-action="Index" class="nav-link">Anasayfa</a>
        <a href="#" class="nav-link">Profil</a>
        <a asp-controller="QuestionBank" asp-action="Index" class="nav-link nav-link-active">Soru Bankası</a>
        <a asp-controller="Exam" asp-action="Index" class="nav-link">Sınavlar</a>
        <a href="#" class="nav-link">Ayarlar</a>
    </div>
</nav>

<div class="dashboard-container">
    <div class="qb-header">
        <div>
            <h1>Soru Bankaları</h1>
            <p>Çalışmak istediğin alanı seç ve hemen çözmeye başla.</p>
        </div>

        <!-- 🔹 SAĞ ÜSTTE 3 BUTON -->
        <div class="qb-filter-buttons">
            <button class="btn btn-primary active"
                    onclick="filterSelection('all', this)">
                Tümü
            </button>
            <button class="btn btn-outline-primary"
                    onclick="filterSelection('TYT', this)">
                TYT
            </button>
            <button class="btn btn-outline-primary"
                    onclick="filterSelection('AYT', this)">
                AYT
            </button>
        </div>
    </div>

    <div class="qb-grid">
        @if (Model != null && Model.Any())
        {
            @foreach (var item in Model)
            {
                <div class="card qb-card filter-item"
                     data-category="@item.ExamName"
                     style="overflow: hidden;">

                    <div class="qb-img-container"
                         style="height: 180px; overflow: hidden; position: relative; background-color: #f0f0f0;">
                        <img src="@(!string.IsNullOrEmpty(item.ImageUrl) ? item.ImageUrl : "/img/default.jpg")"
                             alt="@item.BankName"
                             style="width: 100%; height: 100%; object-fit: cover;"
                             onerror="this.src='/img/default.jpg'">

                        <span class="badge @(item.ExamName == "TYT" ? "bg-primary" : "bg-danger")"
                              style="position: absolute; top: 10px; right: 10px; opacity: 0.9;">
                            @item.ExamName
                        </span>
                    </div>

                    <div class="card-body" style="padding: 15px;">
                        <h5 class="card-title" style="font-weight: bold; margin-bottom: 5px;">
                            @item.BankName
                        </h5>

                        <p class="text-muted" style="font-size: 0.85em; margin-bottom: 10px;">
                            <i class="bi bi-book"></i> @item.Publisher
                        </p>

                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="badge bg-light text-dark border">
                                @item.LessonName
                            </span>
                            <span style="font-size: 0.9em; color: #666;">
                                @item.QuestionCount Soru
                            </span>
                        </div>

                        <a asp-controller="QuestionBank"
                           asp-action="Details"
                           asp-route-examTypeId="@item.ExamTypeId"
                           asp-route-lessonId="@item.LessonId"
                           class="btn btn-outline-primary w-100">
                            Soruları Çöz
                        </a>
                    </div>
                </div>
            }
        }
        else
        {
            <div class="alert alert-warning">
                Henüz sisteme yüklenmiş soru bulunmamaktadır.
            </div>
        }
    </div>
</div>

<script>
    function filterSelection(category, btn) {
        var items = document.getElementsByClassName("filter-item");

        for (var i = 0; i < items.length; i++) {
            var itemCategory = items[i].getAttribute("data-category");

            if (category === "all") {
                items[i].style.display = "block";
            } else {
                items[i].style.display = (itemCategory === category) ? "block" : "none";
            }
        }

        var buttons = document.querySelectorAll(".qb-filter-buttons .btn");
        buttons.forEach(function (b) {
            b.classList.remove("active", "btn-primary");
            b.classList.add("btn-outline-primary");
        });

        btn.classList.remove("btn-outline-primary");
        btn.classList.add("btn-primary", "active");
    }
</script>
